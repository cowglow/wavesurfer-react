import{r as w,R as V}from"./index-61bf1805.js";import"./_commonjsHelpers-de833af9.js";var X={exports:{}},M={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q=w,Z=Symbol.for("react.element"),tt=Symbol.for("react.fragment"),et=Object.prototype.hasOwnProperty,it=Q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,nt={key:!0,ref:!0,__self:!0,__source:!0};function G(o,t,i){var e,n={},s=null,r=null;i!==void 0&&(s=""+i),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(r=t.ref);for(e in t)et.call(t,e)&&!nt.hasOwnProperty(e)&&(n[e]=t[e]);if(o&&o.defaultProps)for(e in t=o.defaultProps,t)n[e]===void 0&&(n[e]=t[e]);return{$$typeof:Z,type:o,key:s,ref:r,props:n,_owner:it.current}}M.Fragment=tt;M.jsx=G;M.jsxs=G;X.exports=M;var x=X.exports;const rt=w.createContext(null);globalThis&&globalThis.__rest;globalThis&&globalThis.__rest;const Y=({id:o="waveform",children:t})=>V.createElement("div",{id:o},t),st=["audioRate","audioContext","audioScriptProcessor","autoCenter","backend","backgroundColor","barGap","barHeight","barMinHeight","barRadius","barWidth","closeAudioContext","cursorColor","cursorWidth","fillParent","forceDecode","height","hideScrollbar","interact","loopSelection","maxCanvasWidth","mediaControls","mediaType","minPxPerSec","normalize","partialRender","pixelRatio","progressColor","removeMediaElementOnDestroy","renderer","responsive","scrollParent","skipLength","splitChannels","waveColor","autoCenterRate","autoCenterImmediately","drawingContextAttributes","duration","ignoreSilenceMode","rtl","splitChannelsOptions","vertical","xhr"],ot=o=>o?st.reduce((t,i)=>Object.prototype.hasOwnProperty.call(o,i)?Object.assign(Object.assign({},t),{[i]:o[i]}):t,{}):{};function S(o,t,i,e){return new(i||(i=Promise))(function(n,s){function r(d){try{l(e.next(d))}catch(h){s(h)}}function a(d){try{l(e.throw(d))}catch(h){s(h)}}function l(d){var h;d.done?n(d.value):(h=d.value,h instanceof i?h:new i(function(c){c(h)})).then(r,a)}l((e=e.apply(o,t||[])).next())})}const B={decode:function(o,t){return S(this,void 0,void 0,function*(){const i=new AudioContext({sampleRate:t}),e=i.decodeAudioData(o);return e.finally(()=>i.close()),e})},createBuffer:function(o,t){return typeof o[0]=="number"&&(o=[o]),function(i){const e=i[0];if(e.some(n=>n>1||n<-1)){const n=e.length;let s=0;for(let r=0;r<n;r++){const a=Math.abs(e[r]);a>s&&(s=a)}for(const r of i)for(let a=0;a<n;a++)r[a]/=s}}(o),{duration:t,length:o[0].length,sampleRate:o[0].length/t,numberOfChannels:o.length,getChannelData:i=>o==null?void 0:o[i],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}},at={fetchBlob:function(o,t,i){var e,n;return S(this,void 0,void 0,function*(){const s=yield fetch(o,i);{const r=(e=s.clone().body)===null||e===void 0?void 0:e.getReader(),a=Number((n=s.headers)===null||n===void 0?void 0:n.get("Content-Length"));let l=0;const d=(h,c)=>S(this,void 0,void 0,function*(){if(h)return;l+=(c==null?void 0:c.length)||0;const p=Math.round(l/a*100);return t(p),r==null?void 0:r.read().then(({done:m,value:u})=>d(m,u))});r==null||r.read().then(({done:h,value:c})=>d(h,c))}return s.blob()})}};class W{constructor(){this.listeners={}}on(t,i){return this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(i),()=>this.un(t,i)}once(t,i){const e=this.on(t,i),n=this.on(t,()=>{e(),n()});return e}un(t,i){this.listeners[t]&&(i?this.listeners[t].delete(i):delete this.listeners[t])}unAll(){this.listeners={}}emit(t,...i){this.listeners[t]&&this.listeners[t].forEach(e=>e(...i))}}class lt extends W{constructor(t){super(),t.media?this.media=t.media:this.media=document.createElement("audio"),t.mediaControls&&(this.media.controls=!0),t.autoplay&&(this.media.autoplay=!0),t.playbackRate!=null&&this.onceMediaEvent("canplay",()=>{t.playbackRate!=null&&(this.media.playbackRate=t.playbackRate)})}onMediaEvent(t,i,e){return this.media.addEventListener(t,i,e),()=>this.media.removeEventListener(t,i)}onceMediaEvent(t,i){return this.onMediaEvent(t,i,{once:!0})}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const t=this.getSrc();t.startsWith("blob:")&&URL.revokeObjectURL(t)}setSrc(t,i){if(this.getSrc()===t)return;this.revokeSrc();const e=i instanceof Blob?URL.createObjectURL(i):t;this.media.src=e,this.media.load()}destroy(){this.media.pause(),this.revokeSrc(),this.media.src="",this.media.load()}play(){return this.media.play()}pause(){this.media.pause()}isPlaying(){return this.media.currentTime>0&&!this.media.paused&&!this.media.ended}setTime(t){this.media.currentTime=t}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(t){this.media.volume=t}getMuted(){return this.media.muted}setMuted(t){this.media.muted=t}getPlaybackRate(){return this.media.playbackRate}setPlaybackRate(t,i){i!=null&&(this.media.preservesPitch=i),this.media.playbackRate=t}getMediaElement(){return this.media}setSinkId(t){return this.media.setSinkId(t)}}class k extends W{constructor(t,i){let e;if(super(),this.timeouts=[],this.isScrolling=!1,this.audioData=null,this.resizeObserver=null,this.isDragging=!1,this.options=t,typeof t.container=="string"?e=document.querySelector(t.container):t.container instanceof HTMLElement&&(e=t.container),!e)throw new Error("Container not found");this.parent=e;const[n,s]=this.initHtml();e.appendChild(n),this.container=n,this.scrollContainer=s.querySelector(".scroll"),this.wrapper=s.querySelector(".wrapper"),this.canvasWrapper=s.querySelector(".canvases"),this.progressWrapper=s.querySelector(".progress"),this.cursor=s.querySelector(".cursor"),i&&s.appendChild(i),this.initEvents()}initEvents(){this.wrapper.addEventListener("click",i=>{const e=this.wrapper.getBoundingClientRect(),n=(i.clientX-e.left)/e.width;this.emit("click",n)}),this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{const{scrollLeft:i,scrollWidth:e,clientWidth:n}=this.scrollContainer,s=i/e,r=(i+n)/e;this.emit("scroll",s,r)});const t=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{t(()=>this.reRender())}),this.resizeObserver.observe(this.scrollContainer)}initDrag(){(function(t,i,e,n,s=5){let r=()=>{};if(!t)return r;const a=l=>{if(l.button===2)return;l.preventDefault(),l.stopPropagation();let d=l.clientX,h=l.clientY,c=!1;const p=g=>{g.preventDefault(),g.stopPropagation();const v=g.clientX,y=g.clientY;if(c||Math.abs(v-d)>=s||Math.abs(y-h)>=s){const{left:C,top:E}=t.getBoundingClientRect();c||(c=!0,e==null||e(d-C,h-E)),i(v-d,y-h,v-C,y-E),d=v,h=y}},m=g=>{c&&(g.preventDefault(),g.stopPropagation())},u=()=>{c&&(n==null||n()),r()};document.addEventListener("pointermove",p),document.addEventListener("pointerup",u),document.addEventListener("pointerleave",u),document.addEventListener("click",m,!0),r=()=>{document.removeEventListener("pointermove",p),document.removeEventListener("pointerup",u),document.removeEventListener("pointerleave",u),setTimeout(()=>{document.removeEventListener("click",m,!0)},10)}};t.addEventListener("pointerdown",a)})(this.wrapper,(t,i,e)=>{this.emit("drag",Math.max(0,Math.min(1,e/this.wrapper.clientWidth)))},()=>this.isDragging=!0,()=>this.isDragging=!1)}getHeight(){return this.options.height==null?128:isNaN(Number(this.options.height))?this.options.height==="auto"&&this.parent.clientHeight||128:Number(this.options.height)}initHtml(){const t=document.createElement("div"),i=t.attachShadow({mode:"open"});return i.innerHTML=`
      <style>
        :host {
          user-select: none;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
          touch-action: none;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight()}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper">
          <div class="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[t,i]}setOptions(t){this.options=t,this.reRender()}getWrapper(){return this.wrapper}getScroll(){return this.scrollContainer.scrollLeft}destroy(){var t;this.container.remove(),(t=this.resizeObserver)===null||t===void 0||t.disconnect()}createDelay(t=10){const i={};return this.timeouts.push(i),e=>{i.timeout&&clearTimeout(i.timeout),i.timeout=setTimeout(e,t)}}convertColorValues(t){if(!Array.isArray(t))return t||"";if(t.length<2)return t[0]||"";const i=document.createElement("canvas"),e=i.getContext("2d").createLinearGradient(0,0,0,i.height),n=1/(t.length-1);return t.forEach((s,r)=>{const a=r*n;e.addColorStop(a,s)}),e}renderBars(t,i,e){if(e.fillStyle=this.convertColorValues(i.waveColor),i.renderFunction)return void i.renderFunction(t,e);const n=t[0],s=t[1]||t[0],r=n.length,a=window.devicePixelRatio||1,{width:l,height:d}=e.canvas,h=d/2,c=i.barHeight||1,p=i.barWidth?i.barWidth*a:1,m=i.barGap?i.barGap*a:i.barWidth?p/2:0,u=i.barRadius||0,g=l/(p+m)/r;let v=1;if(i.normalize){v=0;for(let f=0;f<r;f++){const O=Math.abs(n[f]);O>v&&(v=O)}}const y=h/v*c,C=u&&"roundRect"in e?"roundRect":"rect";e.beginPath();let E=0,P=0,b=0;for(let f=0;f<=r;f++){const O=Math.round(f*g);if(O>E){const $=Math.round(P*y),I=$+Math.round(b*y)||1;let L=h-$;i.barAlign==="top"?L=0:i.barAlign==="bottom"&&(L=d-I),e[C](E*(p+m),L,p,I,u),E=O,P=0,b=0}const z=Math.abs(n[f]||0),A=Math.abs(s[f]||0);z>P&&(P=z),A>b&&(b=A)}e.fill(),e.closePath()}renderSingleCanvas(t,i,e,n,s,r,a,l){const d=window.devicePixelRatio||1,h=document.createElement("canvas"),c=t[0].length;h.width=Math.round(e*(r-s)/c),h.height=n*d,h.style.width=`${Math.floor(h.width/d)}px`,h.style.height=`${n}px`,h.style.left=`${Math.floor(s*e/d/c)}px`,a.appendChild(h);const p=h.getContext("2d");this.renderBars(t.map(g=>g.slice(s,r)),i,p);const m=h.cloneNode();l.appendChild(m);const u=m.getContext("2d");h.width>0&&h.height>0&&u.drawImage(h,0,0),u.globalCompositeOperation="source-in",u.fillStyle=this.convertColorValues(i.progressColor),u.fillRect(0,0,h.width,h.height)}renderWaveform(t,i,e){const n=document.createElement("div"),s=this.getHeight();n.style.height=`${s}px`,this.canvasWrapper.style.minHeight=`${s}px`,this.canvasWrapper.appendChild(n);const r=n.cloneNode();this.progressWrapper.appendChild(r);const{scrollLeft:a,scrollWidth:l,clientWidth:d}=this.scrollContainer,h=t[0].length,c=h/l;let p=Math.min(k.MAX_CANVAS_WIDTH,d);if(i.barWidth||i.barGap){const b=i.barWidth||.5,f=b+(i.barGap||b/2);p%f!=0&&(p=Math.floor(p/f)*f)}const m=Math.floor(Math.abs(a)*c),u=Math.floor(m+p*c),g=u-m,v=(b,f)=>{this.renderSingleCanvas(t,i,e,s,Math.max(0,b),Math.min(f,h),n,r)},y=this.createDelay(),C=this.createDelay(),E=(b,f)=>{v(b,f),b>0&&y(()=>{E(b-g,f-g)})},P=(b,f)=>{v(b,f),f<h&&C(()=>{P(b+g,f+g)})};E(m,u),u<h&&P(u,u+g)}render(t){this.timeouts.forEach(a=>a.timeout&&clearTimeout(a.timeout)),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.wrapper.style.width="";const i=window.devicePixelRatio||1,e=this.scrollContainer.clientWidth,n=Math.ceil(t.duration*(this.options.minPxPerSec||0));this.isScrolling=n>e;const s=this.options.fillParent&&!this.isScrolling,r=(s?e:n)*i;if(this.wrapper.style.width=s?"100%":`${n}px`,this.scrollContainer.style.overflowX=this.isScrolling?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.options.splitChannels)for(let a=0;a<t.numberOfChannels;a++){const l=Object.assign(Object.assign({},this.options),this.options.splitChannels[a]);this.renderWaveform([t.getChannelData(a)],l,r)}else{const a=[t.getChannelData(0)];t.numberOfChannels>1&&a.push(t.getChannelData(1)),this.renderWaveform(a,this.options,r)}this.audioData=t,this.emit("render")}reRender(){if(!this.audioData)return;const t=this.progressWrapper.clientWidth;this.render(this.audioData);const i=this.progressWrapper.clientWidth;this.scrollContainer.scrollLeft+=i-t}zoom(t){this.options.minPxPerSec=t,this.reRender()}scrollIntoView(t,i=!1){const{clientWidth:e,scrollLeft:n,scrollWidth:s}=this.scrollContainer,r=s*t,a=e/2;if(r>n+(i&&this.options.autoCenter&&!this.isDragging?a:e)||r<n)if(this.options.autoCenter&&!this.isDragging){const l=a/20;r-(n+a)>=l&&r<n+e?this.scrollContainer.scrollLeft+=l:this.scrollContainer.scrollLeft=r-a}else this.isDragging?this.scrollContainer.scrollLeft=r<n?r-10:r-e+10:this.scrollContainer.scrollLeft=r;{const{scrollLeft:l}=this.scrollContainer,d=l/s,h=(l+e)/s;this.emit("scroll",d,h)}}renderProgress(t,i){isNaN(t)||(this.progressWrapper.style.width=100*t+"%",this.cursor.style.left=100*t+"%",this.cursor.style.marginLeft=Math.round(100*t)===100?`-${this.options.cursorWidth}px`:"",this.isScrolling&&this.options.autoScroll&&this.scrollIntoView(t,i))}}k.MAX_CANVAS_WIDTH=4e3;class ht extends W{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}const dt={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class T extends lt{static create(t){return new T(t)}constructor(t){var i,e;super({media:t.media,mediaControls:t.mediaControls,autoplay:t.autoplay,playbackRate:t.audioRate}),this.plugins=[],this.decodedData=null,this.duration=null,this.subscriptions=[],this.options=Object.assign({},dt,t),this.timer=new ht;const n=t.media?void 0:this.getMediaElement();this.renderer=new k(this.options,n),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const s=this.options.url||((i=this.options.media)===null||i===void 0?void 0:i.currentSrc)||((e=this.options.media)===null||e===void 0?void 0:e.src);s&&this.load(s,this.options.peaks,this.options.duration)}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{const t=this.getCurrentTime();this.renderer.renderProgress(t/this.getDuration(),!0),this.emit("timeupdate",t),this.emit("audioprocess",t)}))}initPlayerEvents(){this.subscriptions.push(this.onMediaEvent("timeupdate",()=>{const t=this.getCurrentTime();this.renderer.renderProgress(t/this.getDuration(),this.isPlaying()),this.emit("timeupdate",t)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop()}),this.onMediaEvent("ended",()=>{this.emit("finish")}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",t=>{this.options.interact&&(this.seekTo(t),this.emit("interaction",this.getCurrentTime()),this.emit("click",t))}),this.renderer.on("scroll",(t,i)=>{const e=this.getDuration();this.emit("scroll",t*e,i*e)}),this.renderer.on("render",()=>{this.emit("redraw")}));{let t;this.subscriptions.push(this.renderer.on("drag",i=>{this.options.interact&&(this.renderer.renderProgress(i),clearTimeout(t),t=setTimeout(()=>{this.seekTo(i)},this.isPlaying()?0:200),this.emit("interaction",i*this.getDuration()),this.emit("drag",i))}))}}initPlugins(){var t;!((t=this.options.plugins)===null||t===void 0)&&t.length&&this.options.plugins.forEach(i=>{this.registerPlugin(i)})}setOptions(t){this.options=Object.assign({},this.options,t),this.renderer.setOptions(this.options),t.audioRate&&this.setPlaybackRate(t.audioRate),t.mediaControls!=null&&(this.getMediaElement().controls=t.mediaControls)}registerPlugin(t){return t.init(this),this.plugins.push(t),this.subscriptions.push(t.once("destroy",()=>{this.plugins=this.plugins.filter(i=>i!==t)})),t}getWrapper(){return this.renderer.getWrapper()}getScroll(){return this.renderer.getScroll()}getActivePlugins(){return this.plugins}loadAudio(t,i,e,n){return S(this,void 0,void 0,function*(){if(this.emit("load",t),this.isPlaying()&&this.pause(),this.decodedData=null,this.duration=null,!i&&!e){const s=r=>this.emit("loading",r);i=yield at.fetchBlob(t,s,this.options.fetchParams)}if(this.setSrc(t,i),this.duration=(yield Promise.resolve(n||this.getDuration()))||(yield new Promise(s=>{this.onceMediaEvent("loadedmetadata",()=>s(this.getDuration()))}))||(yield Promise.resolve(0)),e)this.decodedData=B.createBuffer(e,this.duration);else if(i){const s=yield i.arrayBuffer();this.decodedData=yield B.decode(s,this.options.sampleRate),this.duration!==0&&this.duration!==1/0||(this.duration=this.decodedData.duration)}this.emit("decode",this.duration),this.decodedData&&this.renderer.render(this.decodedData),this.emit("ready",this.duration)})}load(t,i,e){return S(this,void 0,void 0,function*(){this.loadAudio(t,void 0,i,e)})}loadBlob(t,i,e){return S(this,void 0,void 0,function*(){this.loadAudio("blob",t,i,e)})}zoom(t){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(t),this.emit("zoom",t)}getDecodedData(){return this.decodedData}exportPeaks({channels:t=1,maxLength:i=8e3,precision:e=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const n=Math.min(t,this.decodedData.numberOfChannels),s=[];for(let r=0;r<n;r++){const a=this.decodedData.getChannelData(r),l=Math.min(a.length,i),d=a.length/l,h=[];for(let c=0;c<l;c++){const p=a[Math.round(c*d)];h.push(Math.round(p*e)/e)}s.push(h)}return s}getDuration(){return this.duration!==null?this.duration:super.getDuration()}toggleInteraction(t){this.options.interact=t}seekTo(t){const i=this.getDuration()*t;this.setTime(i)}playPause(){return S(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(t){this.setTime(this.getCurrentTime()+t)}empty(){this.load("",[[0]],.001)}destroy(){this.emit("destroy"),this.plugins.forEach(t=>t.destroy()),this.subscriptions.forEach(t=>t()),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}function ct(o){return T.create(o)}function H(o){const{plugin:t,options:i,creator:e="create"}=o,n=t[e];if(!t)throw new Error("Please pass a valid plugin in plugin list");if(!e)throw new Error("Please pass the creator function name in 'creator' property.");if(typeof n!="function")throw new Error(`"${e}" is not callable on given plugin. Please pass a valid 'creator' in plugins list.`);return n(i)}const ut=(o,t)=>{const i=[...o],e=[...t],n=i.filter(r=>e.findIndex(a=>a.name===r.name)===-1),s=e.filter(r=>i.findIndex(a=>a.name===r.name)===-1);return{disabled:n,enabled:s}};var pt=globalThis&&globalThis.__rest||function(o,t){var i={};for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&t.indexOf(e)<0&&(i[e]=o[e]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,e=Object.getOwnPropertySymbols(o);n<e.length;n++)t.indexOf(e[n])<0&&Object.prototype.propertyIsEnumerable.call(o,e[n])&&(i[e[n]]=o[e[n]]);return i};function gt(o){var{container:t,plugins:i=[],onMount:e}=o,n=pt(o,["container","plugins","onMount"]);const s=w.useRef([]),[r,a]=w.useState(null);return w.useEffect(()=>{if(!t)return;let l=[];i&&(l=i.map(H)),s.current=l;const d=ct(Object.assign(Object.assign({container:t},n),{plugins:l}));return e==null||e(d),a(d),()=>{d.destroy()}},[t]),w.useEffect(()=>{if(r){const l=i.map(H),{disabled:d,enabled:h}=ut(s.current,l);s.current=l,d.forEach(c=>{c.name&&(r==null||r.destroyPlugin(c.name))}),h.forEach(c=>{c.name&&(r==null||r.addPlugin(c).initPlugin(c.name))})}},[i]),r}function ft(o){return!!o&&typeof o!="string"&&typeof o!="number"&&typeof o!="boolean"&&"type"in o&&"props"in o}var mt=globalThis&&globalThis.__rest||function(o,t){var i={};for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&t.indexOf(e)<0&&(i[e]=o[e]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,e=Object.getOwnPropertySymbols(o);n<e.length;n++)t.indexOf(e[n])<0&&Object.prototype.propertyIsEnumerable.call(o,e[n])&&(i[e[n]]=o[e[n]]);return i};const J=o=>{var{children:t,plugins:i=[],onMount:e}=o,n=mt(o,["children","plugins","onMount"]);const s=w.useMemo(()=>{let a={};return w.Children.forEach(t,l=>{if(typeof l!="object"||l===null||["string","number"].includes(typeof l)||!ft(l))return;const{props:d,type:h}=l;if(h===Y){const{id:c}=d;a=ot(d),a=Object.assign(Object.assign({},a),{container:"#"+c})}}),a},[t]),r=gt(Object.assign(Object.assign({plugins:i,onMount:e},n),s));return V.createElement(rt.Provider,{value:r},t)};J.defaultProps={children:null,plugins:[]};class K{constructor(){this.listeners={}}on(t,i){return this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(i),()=>this.un(t,i)}once(t,i){const e=this.on(t,i),n=this.on(t,()=>{e(),n()});return e}un(t,i){this.listeners[t]&&(i?this.listeners[t].delete(i):delete this.listeners[t])}unAll(){this.listeners={}}emit(t,...i){this.listeners[t]&&this.listeners[t].forEach(e=>e(...i))}}class vt extends K{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(t=>t())}}function D(o,t,i,e,n=5){let s=()=>{};if(!o)return s;const r=a=>{if(a.button===2)return;a.preventDefault(),a.stopPropagation();let l=a.clientX,d=a.clientY,h=!1;const c=u=>{u.preventDefault(),u.stopPropagation();const g=u.clientX,v=u.clientY;if(h||Math.abs(g-l)>=n||Math.abs(v-d)>=n){const{left:y,top:C}=o.getBoundingClientRect();h||(h=!0,i==null||i(l-y,d-C)),t(g-l,v-d,g-y,v-C),l=g,d=v}},p=u=>{h&&(u.preventDefault(),u.stopPropagation())},m=()=>{h&&(e==null||e()),s()};document.addEventListener("pointermove",c),document.addEventListener("pointerup",m),document.addEventListener("pointerleave",m),document.addEventListener("click",p,!0),s=()=>{document.removeEventListener("pointermove",c),document.removeEventListener("pointerup",m),document.removeEventListener("pointerleave",m),setTimeout(()=>{document.removeEventListener("click",p,!0)},10)}};return o.addEventListener("pointerdown",r),()=>{s(),o.removeEventListener("pointerdown",r)}}class q extends K{constructor(t,i){var e,n,s,r,a,l;super(),this.totalDuration=i,this.minLength=0,this.maxLength=1/0,this.id=t.id||`region-${Math.random().toString(32).slice(2)}`,this.start=t.start,this.end=(e=t.end)!==null&&e!==void 0?e:t.start,this.drag=(n=t.drag)!==null&&n!==void 0?n:!0,this.resize=(s=t.resize)!==null&&s!==void 0?s:!0,this.color=(r=t.color)!==null&&r!==void 0?r:"rgba(0, 0, 0, 0.1)",this.minLength=(a=t.minLength)!==null&&a!==void 0?a:this.minLength,this.maxLength=(l=t.maxLength)!==null&&l!==void 0?l:this.maxLength,this.element=this.initElement(t.content),this.renderPosition(),this.initMouseEvents()}initElement(t){const i=document.createElement("div"),e=this.start===this.end;if(i.setAttribute("part",`${e?"marker":"region"} ${this.id}`),i.setAttribute("style",`
      position: absolute;
      height: 100%;
      background-color: ${e?"none":this.color};
      border-left: ${e?"2px solid "+this.color:"none"};
      border-radius: 2px;
      box-sizing: border-box;
      transition: background-color 0.2s ease;
      cursor: ${this.drag?"grab":"default"};
      pointer-events: all;
    `),t&&(typeof t=="string"?(this.content=document.createElement("div"),this.content.style.padding=`0.2em ${e?.2:.4}em`,this.content.textContent=t):this.content=t,this.content.setAttribute("part","region-content"),i.appendChild(this.content)),!e){const n=document.createElement("div");n.setAttribute("data-resize","left"),n.setAttribute("style",`
        position: absolute;
        z-index: 2;
        width: 6px;
        height: 100%;
        top: 0;
        left: 0;
        border-left: 2px solid rgba(0, 0, 0, 0.5);
        border-radius: 2px 0 0 2px;
        cursor: ${this.resize?"ew-resize":"default"};
        word-break: keep-all;
      `),n.setAttribute("part","region-handle region-handle-left");const s=n.cloneNode();s.setAttribute("data-resize","right"),s.style.left="",s.style.right="0",s.style.borderRight=s.style.borderLeft,s.style.borderLeft="",s.style.borderRadius="0 2px 2px 0",s.setAttribute("part","region-handle region-handle-right"),i.appendChild(n),i.appendChild(s)}return i}renderPosition(){const t=this.start/this.totalDuration,i=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=`${t*100}%`,this.element.style.right=`${i*100}%`}initMouseEvents(){const{element:t}=this;if(!t)return;t.addEventListener("click",e=>this.emit("click",e)),t.addEventListener("mouseenter",e=>this.emit("over",e)),t.addEventListener("mouseleave",e=>this.emit("leave",e)),t.addEventListener("dblclick",e=>this.emit("dblclick",e)),D(t,e=>this.onMove(e),()=>this.onStartMoving(),()=>this.onEndMoving());const i=1;D(t.querySelector('[data-resize="left"]'),e=>this.onResize(e,"start"),()=>null,()=>this.onEndResizing(),i),D(t.querySelector('[data-resize="right"]'),e=>this.onResize(e,"end"),()=>null,()=>this.onEndResizing(),i)}onStartMoving(){this.drag&&(this.element.style.cursor="grabbing")}onEndMoving(){this.drag&&(this.element.style.cursor="grab",this.emit("update-end"))}_onUpdate(t,i){if(!this.element.parentElement)return;const e=t/this.element.parentElement.clientWidth*this.totalDuration,n=!i||i==="start"?this.start+e:this.start,s=!i||i==="end"?this.end+e:this.end,r=s-n;n>=0&&s<=this.totalDuration&&n<=s&&r>=this.minLength&&r<=this.maxLength&&(this.start=n,this.end=s,this.renderPosition(),this.emit("update"))}onMove(t){this.drag&&this._onUpdate(t)}onResize(t,i){this.resize&&this._onUpdate(t,i)}onEndResizing(){this.resize&&this.emit("update-end")}_setTotalDuration(t){this.totalDuration=t,this.renderPosition()}play(){this.emit("play")}setOptions(t){var i,e;t.color&&(this.color=t.color,this.element.style.backgroundColor=this.color),t.drag!==void 0&&(this.drag=t.drag,this.element.style.cursor=this.drag?"grab":"default"),t.resize!==void 0&&(this.resize=t.resize,this.element.querySelectorAll("[data-resize]").forEach(n=>{n.style.cursor=this.resize?"ew-resize":"default"})),(t.start!==void 0||t.end!==void 0)&&(this.start=(i=t.start)!==null&&i!==void 0?i:this.start,this.end=(e=t.end)!==null&&e!==void 0?e:this.end,this.renderPosition())}remove(){this.emit("remove"),this.element.remove(),this.element=null}}class j extends vt{constructor(t){super(t),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(t){return new j(t)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let t=null;this.subscriptions.push(this.wavesurfer.on("timeupdate",i=>{const e=this.regions.find(n=>n.start<=i&&n.end>=i);t&&t!==e&&(this.emit("region-out",t),t=null),e&&e!==t&&(t=e,this.emit("region-in",e))}))}initRegionsContainer(){const t=document.createElement("div");return t.setAttribute("style",`
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 3;
      pointer-events: none;
    `),t}getRegions(){return this.regions}avoidOverlapping(t){if(!t.content)return;const i=t.content,e=i.getBoundingClientRect().left,n=t.element.scrollWidth,s=this.regions.filter(r=>{if(r===t||!r.content)return!1;const a=r.content.getBoundingClientRect().left,l=r.element.scrollWidth;return e<a+l&&a<e+n}).map(r=>{var a;return((a=r.content)===null||a===void 0?void 0:a.getBoundingClientRect().height)||0}).reduce((r,a)=>r+a,0);i.style.marginTop=`${s}px`}saveRegion(t){this.regionsContainer.appendChild(t.element),this.avoidOverlapping(t),this.regions.push(t),this.emit("region-created",t);const i=[t.on("update-end",()=>{this.avoidOverlapping(t),this.emit("region-updated",t)}),t.on("play",()=>{var e,n;(e=this.wavesurfer)===null||e===void 0||e.play(),(n=this.wavesurfer)===null||n===void 0||n.setTime(t.start)}),t.on("click",e=>{this.emit("region-clicked",t,e)}),t.on("dblclick",e=>{this.emit("region-double-clicked",t,e)}),t.once("remove",()=>{i.forEach(e=>e()),this.regions=this.regions.filter(e=>e!==t)})];this.subscriptions.push(...i)}addRegion(t){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const i=this.wavesurfer.getDuration(),e=new q(t,i);return i?this.saveRegion(e):this.subscriptions.push(this.wavesurfer.once("ready",n=>{e._setTotalDuration(n),this.saveRegion(e)})),e}enableDragSelection(t){var i,e;const n=(e=(i=this.wavesurfer)===null||i===void 0?void 0:i.getWrapper())===null||e===void 0?void 0:e.querySelector("div");if(!n)return()=>{};const s=5;let r=null,a=0;return D(n,(l,d,h)=>{r&&r._onUpdate(l,h>a?"end":"start")},l=>{if(a=l,!this.wavesurfer)return;const d=this.wavesurfer.getDuration(),h=this.wavesurfer.getWrapper().clientWidth,c=l/h*d,p=(l+s)/h*d;r=new q(Object.assign(Object.assign({},t),{start:c,end:p}),d),this.regionsContainer.appendChild(r.element)},()=>{r&&(this.saveRegion(r),r=null)})}clearRegions(){this.regions.forEach(t=>t.remove())}destroy(){this.clearRegions(),super.destroy()}}const bt=[{plugin:j,options:{dragSelection:!0}}];function _(o){const t=w.useRef(null),i=w.useCallback(n=>{t.current=n,t.current&&(t.current.load(o.source),t.current.on("ready",()=>{console.log("WaveSurfer is ready")}))},[]),e=w.useCallback(()=>{t.current&&t.current.playPause()},[]);return x.jsxs("div",{style:{border:"thin solid red"},children:[x.jsx("h1",{children:"Audio Player: WaveSurfer"}),x.jsxs(J,{plugins:bt,onMount:i,children:[x.jsx(Y,{id:"waveform",cursorColor:"transparent"}),x.jsx("div",{id:"timeline"})]}),x.jsx("button",{onClick:e,children:"Play / Pause"}),x.jsx("pre",{children:JSON.stringify({props:o},null,2)})]})}try{_.displayName="AudioPlayer",_.__docgenInfo={description:"",displayName:"AudioPlayer",props:{source:{defaultValue:null,description:"",name:"source",required:!0,type:{name:"unknown"}}}}}catch{}const Ct={title:"Components/AudioPlayer",component:_,argTypes:{source:"string"}},R={args:{source:"/recording.wav"}};var F,N,U;R.parameters={...R.parameters,docs:{...(F=R.parameters)==null?void 0:F.docs,source:{originalSource:`{
  args: {
    source: "/recording.wav"
  }
}`,...(U=(N=R.parameters)==null?void 0:N.docs)==null?void 0:U.source}}};const Et=["Primary"];export{R as Primary,Et as __namedExportsOrder,Ct as default};
//# sourceMappingURL=AudioPlayer.stories-9160cc35.js.map
