import{j as x}from"./jsx-dev-runtime-bf4fb7a0.js";import{r as w,R as X}from"./index-c589f95a.js";import"./_commonjsHelpers-de833af9.js";const Y=w.createContext(null);globalThis&&globalThis.__rest;globalThis&&globalThis.__rest;const F=({id:o="waveform",children:e})=>X.createElement("div",{id:o},e),J=["audioRate","audioContext","audioScriptProcessor","autoCenter","backend","backgroundColor","barGap","barHeight","barMinHeight","barRadius","barWidth","closeAudioContext","cursorColor","cursorWidth","fillParent","forceDecode","height","hideScrollbar","interact","loopSelection","maxCanvasWidth","mediaControls","mediaType","minPxPerSec","normalize","partialRender","pixelRatio","progressColor","removeMediaElementOnDestroy","renderer","responsive","scrollParent","skipLength","splitChannels","waveColor","autoCenterRate","autoCenterImmediately","drawingContextAttributes","duration","ignoreSilenceMode","rtl","splitChannelsOptions","vertical","xhr"],K=o=>o?J.reduce((e,i)=>Object.prototype.hasOwnProperty.call(o,i)?Object.assign(Object.assign({},e),{[i]:o[i]}):e,{}):{};function S(o,e,i,t){return new(i||(i=Promise))(function(n,s){function r(d){try{l(t.next(d))}catch(h){s(h)}}function a(d){try{l(t.throw(d))}catch(h){s(h)}}function l(d){var h;d.done?n(d.value):(h=d.value,h instanceof i?h:new i(function(c){c(h)})).then(r,a)}l((t=t.apply(o,e||[])).next())})}const $={decode:function(o,e){return S(this,void 0,void 0,function*(){const i=new AudioContext({sampleRate:e}),t=i.decodeAudioData(o);return t.finally(()=>i.close()),t})},createBuffer:function(o,e){return typeof o[0]=="number"&&(o=[o]),function(i){const t=i[0];if(t.some(n=>n>1||n<-1)){const n=t.length;let s=0;for(let r=0;r<n;r++){const a=Math.abs(t[r]);a>s&&(s=a)}for(const r of i)for(let a=0;a<n;a++)r[a]/=s}}(o),{duration:e,length:o[0].length,sampleRate:o[0].length/e,numberOfChannels:o.length,getChannelData:i=>o==null?void 0:o[i],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}},Q={fetchBlob:function(o,e,i){var t,n;return S(this,void 0,void 0,function*(){const s=yield fetch(o,i);{const r=(t=s.clone().body)===null||t===void 0?void 0:t.getReader(),a=Number((n=s.headers)===null||n===void 0?void 0:n.get("Content-Length"));let l=0;const d=(h,c)=>S(this,void 0,void 0,function*(){if(h)return;l+=(c==null?void 0:c.length)||0;const p=Math.round(l/a*100);return e(p),r==null?void 0:r.read().then(({done:f,value:u})=>d(f,u))});r==null||r.read().then(({done:h,value:c})=>d(h,c))}return s.blob()})}};class W{constructor(){this.listeners={}}on(e,i){return this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(i),()=>this.un(e,i)}once(e,i){const t=this.on(e,i),n=this.on(e,()=>{t(),n()});return t}un(e,i){this.listeners[e]&&(i?this.listeners[e].delete(i):delete this.listeners[e])}unAll(){this.listeners={}}emit(e,...i){this.listeners[e]&&this.listeners[e].forEach(t=>t(...i))}}class Z extends W{constructor(e){super(),e.media?this.media=e.media:this.media=document.createElement("audio"),e.mediaControls&&(this.media.controls=!0),e.autoplay&&(this.media.autoplay=!0),e.playbackRate!=null&&this.onceMediaEvent("canplay",()=>{e.playbackRate!=null&&(this.media.playbackRate=e.playbackRate)})}onMediaEvent(e,i,t){return this.media.addEventListener(e,i,t),()=>this.media.removeEventListener(e,i)}onceMediaEvent(e,i){return this.onMediaEvent(e,i,{once:!0})}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const e=this.getSrc();e.startsWith("blob:")&&URL.revokeObjectURL(e)}setSrc(e,i){if(this.getSrc()===e)return;this.revokeSrc();const t=i instanceof Blob?URL.createObjectURL(i):e;this.media.src=t,this.media.load()}destroy(){this.media.pause(),this.revokeSrc(),this.media.src="",this.media.load()}play(){return this.media.play()}pause(){this.media.pause()}isPlaying(){return this.media.currentTime>0&&!this.media.paused&&!this.media.ended}setTime(e){this.media.currentTime=e}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(e){this.media.volume=e}getMuted(){return this.media.muted}setMuted(e){this.media.muted=e}getPlaybackRate(){return this.media.playbackRate}setPlaybackRate(e,i){i!=null&&(this.media.preservesPitch=i),this.media.playbackRate=e}getMediaElement(){return this.media}setSinkId(e){return this.media.setSinkId(e)}}class M extends W{constructor(e,i){let t;if(super(),this.timeouts=[],this.isScrolling=!1,this.audioData=null,this.resizeObserver=null,this.isDragging=!1,this.options=e,typeof e.container=="string"?t=document.querySelector(e.container):e.container instanceof HTMLElement&&(t=e.container),!t)throw new Error("Container not found");this.parent=t;const[n,s]=this.initHtml();t.appendChild(n),this.container=n,this.scrollContainer=s.querySelector(".scroll"),this.wrapper=s.querySelector(".wrapper"),this.canvasWrapper=s.querySelector(".canvases"),this.progressWrapper=s.querySelector(".progress"),this.cursor=s.querySelector(".cursor"),i&&s.appendChild(i),this.initEvents()}initEvents(){this.wrapper.addEventListener("click",i=>{const t=this.wrapper.getBoundingClientRect(),n=(i.clientX-t.left)/t.width;this.emit("click",n)}),this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{const{scrollLeft:i,scrollWidth:t,clientWidth:n}=this.scrollContainer,s=i/t,r=(i+n)/t;this.emit("scroll",s,r)});const e=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{e(()=>this.reRender())}),this.resizeObserver.observe(this.scrollContainer)}initDrag(){(function(e,i,t,n,s=5){let r=()=>{};if(!e)return r;const a=l=>{if(l.button===2)return;l.preventDefault(),l.stopPropagation();let d=l.clientX,h=l.clientY,c=!1;const p=m=>{m.preventDefault(),m.stopPropagation();const v=m.clientX,y=m.clientY;if(c||Math.abs(v-d)>=s||Math.abs(y-h)>=s){const{left:C,top:E}=e.getBoundingClientRect();c||(c=!0,t==null||t(d-C,h-E)),i(v-d,y-h,v-C,y-E),d=v,h=y}},f=m=>{c&&(m.preventDefault(),m.stopPropagation())},u=()=>{c&&(n==null||n()),r()};document.addEventListener("pointermove",p),document.addEventListener("pointerup",u),document.addEventListener("pointerleave",u),document.addEventListener("click",f,!0),r=()=>{document.removeEventListener("pointermove",p),document.removeEventListener("pointerup",u),document.removeEventListener("pointerleave",u),setTimeout(()=>{document.removeEventListener("click",f,!0)},10)}};e.addEventListener("pointerdown",a)})(this.wrapper,(e,i,t)=>{this.emit("drag",Math.max(0,Math.min(1,t/this.wrapper.clientWidth)))},()=>this.isDragging=!0,()=>this.isDragging=!1)}getHeight(){return this.options.height==null?128:isNaN(Number(this.options.height))?this.options.height==="auto"&&this.parent.clientHeight||128:Number(this.options.height)}initHtml(){const e=document.createElement("div"),i=e.attachShadow({mode:"open"});return i.innerHTML=`
      <style>
        :host {
          user-select: none;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
          touch-action: none;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight()}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper">
          <div class="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[e,i]}setOptions(e){this.options=e,this.reRender()}getWrapper(){return this.wrapper}getScroll(){return this.scrollContainer.scrollLeft}destroy(){var e;this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect()}createDelay(e=10){const i={};return this.timeouts.push(i),t=>{i.timeout&&clearTimeout(i.timeout),i.timeout=setTimeout(t,e)}}convertColorValues(e){if(!Array.isArray(e))return e||"";if(e.length<2)return e[0]||"";const i=document.createElement("canvas"),t=i.getContext("2d").createLinearGradient(0,0,0,i.height),n=1/(e.length-1);return e.forEach((s,r)=>{const a=r*n;t.addColorStop(a,s)}),t}renderBars(e,i,t){if(t.fillStyle=this.convertColorValues(i.waveColor),i.renderFunction)return void i.renderFunction(e,t);const n=e[0],s=e[1]||e[0],r=n.length,a=window.devicePixelRatio||1,{width:l,height:d}=t.canvas,h=d/2,c=i.barHeight||1,p=i.barWidth?i.barWidth*a:1,f=i.barGap?i.barGap*a:i.barWidth?p/2:0,u=i.barRadius||0,m=l/(p+f)/r;let v=1;if(i.normalize){v=0;for(let g=0;g<r;g++){const D=Math.abs(n[g]);D>v&&(v=D)}}const y=h/v*c,C=u&&"roundRect"in t?"roundRect":"rect";t.beginPath();let E=0,P=0,b=0;for(let g=0;g<=r;g++){const D=Math.round(g*m);if(D>E){const _=Math.round(P*y),N=_+Math.round(b*y)||1;let L=h-_;i.barAlign==="top"?L=0:i.barAlign==="bottom"&&(L=d-N),t[C](E*(p+f),L,p,N,u),E=D,P=0,b=0}const j=Math.abs(n[g]||0),z=Math.abs(s[g]||0);j>P&&(P=j),z>b&&(b=z)}t.fill(),t.closePath()}renderSingleCanvas(e,i,t,n,s,r,a,l){const d=window.devicePixelRatio||1,h=document.createElement("canvas"),c=e[0].length;h.width=Math.round(t*(r-s)/c),h.height=n*d,h.style.width=`${Math.floor(h.width/d)}px`,h.style.height=`${n}px`,h.style.left=`${Math.floor(s*t/d/c)}px`,a.appendChild(h);const p=h.getContext("2d");this.renderBars(e.map(m=>m.slice(s,r)),i,p);const f=h.cloneNode();l.appendChild(f);const u=f.getContext("2d");h.width>0&&h.height>0&&u.drawImage(h,0,0),u.globalCompositeOperation="source-in",u.fillStyle=this.convertColorValues(i.progressColor),u.fillRect(0,0,h.width,h.height)}renderWaveform(e,i,t){const n=document.createElement("div"),s=this.getHeight();n.style.height=`${s}px`,this.canvasWrapper.style.minHeight=`${s}px`,this.canvasWrapper.appendChild(n);const r=n.cloneNode();this.progressWrapper.appendChild(r);const{scrollLeft:a,scrollWidth:l,clientWidth:d}=this.scrollContainer,h=e[0].length,c=h/l;let p=Math.min(M.MAX_CANVAS_WIDTH,d);if(i.barWidth||i.barGap){const b=i.barWidth||.5,g=b+(i.barGap||b/2);p%g!=0&&(p=Math.floor(p/g)*g)}const f=Math.floor(Math.abs(a)*c),u=Math.floor(f+p*c),m=u-f,v=(b,g)=>{this.renderSingleCanvas(e,i,t,s,Math.max(0,b),Math.min(g,h),n,r)},y=this.createDelay(),C=this.createDelay(),E=(b,g)=>{v(b,g),b>0&&y(()=>{E(b-m,g-m)})},P=(b,g)=>{v(b,g),g<h&&C(()=>{P(b+m,g+m)})};E(f,u),u<h&&P(u,u+m)}render(e){this.timeouts.forEach(a=>a.timeout&&clearTimeout(a.timeout)),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.wrapper.style.width="";const i=window.devicePixelRatio||1,t=this.scrollContainer.clientWidth,n=Math.ceil(e.duration*(this.options.minPxPerSec||0));this.isScrolling=n>t;const s=this.options.fillParent&&!this.isScrolling,r=(s?t:n)*i;if(this.wrapper.style.width=s?"100%":`${n}px`,this.scrollContainer.style.overflowX=this.isScrolling?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.options.splitChannels)for(let a=0;a<e.numberOfChannels;a++){const l=Object.assign(Object.assign({},this.options),this.options.splitChannels[a]);this.renderWaveform([e.getChannelData(a)],l,r)}else{const a=[e.getChannelData(0)];e.numberOfChannels>1&&a.push(e.getChannelData(1)),this.renderWaveform(a,this.options,r)}this.audioData=e,this.emit("render")}reRender(){if(!this.audioData)return;const e=this.progressWrapper.clientWidth;this.render(this.audioData);const i=this.progressWrapper.clientWidth;this.scrollContainer.scrollLeft+=i-e}zoom(e){this.options.minPxPerSec=e,this.reRender()}scrollIntoView(e,i=!1){const{clientWidth:t,scrollLeft:n,scrollWidth:s}=this.scrollContainer,r=s*e,a=t/2;if(r>n+(i&&this.options.autoCenter&&!this.isDragging?a:t)||r<n)if(this.options.autoCenter&&!this.isDragging){const l=a/20;r-(n+a)>=l&&r<n+t?this.scrollContainer.scrollLeft+=l:this.scrollContainer.scrollLeft=r-a}else this.isDragging?this.scrollContainer.scrollLeft=r<n?r-10:r-t+10:this.scrollContainer.scrollLeft=r;{const{scrollLeft:l}=this.scrollContainer,d=l/s,h=(l+t)/s;this.emit("scroll",d,h)}}renderProgress(e,i){isNaN(e)||(this.progressWrapper.style.width=100*e+"%",this.cursor.style.left=100*e+"%",this.cursor.style.marginLeft=Math.round(100*e)===100?`-${this.options.cursorWidth}px`:"",this.isScrolling&&this.options.autoScroll&&this.scrollIntoView(e,i))}}M.MAX_CANVAS_WIDTH=4e3;class ee extends W{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}const te={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class T extends Z{static create(e){return new T(e)}constructor(e){var i,t;super({media:e.media,mediaControls:e.mediaControls,autoplay:e.autoplay,playbackRate:e.audioRate}),this.plugins=[],this.decodedData=null,this.duration=null,this.subscriptions=[],this.options=Object.assign({},te,e),this.timer=new ee;const n=e.media?void 0:this.getMediaElement();this.renderer=new M(this.options,n),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const s=this.options.url||((i=this.options.media)===null||i===void 0?void 0:i.currentSrc)||((t=this.options.media)===null||t===void 0?void 0:t.src);s&&this.load(s,this.options.peaks,this.options.duration)}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{const e=this.getCurrentTime();this.renderer.renderProgress(e/this.getDuration(),!0),this.emit("timeupdate",e),this.emit("audioprocess",e)}))}initPlayerEvents(){this.subscriptions.push(this.onMediaEvent("timeupdate",()=>{const e=this.getCurrentTime();this.renderer.renderProgress(e/this.getDuration(),this.isPlaying()),this.emit("timeupdate",e)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop()}),this.onMediaEvent("ended",()=>{this.emit("finish")}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",e=>{this.options.interact&&(this.seekTo(e),this.emit("interaction",this.getCurrentTime()),this.emit("click",e))}),this.renderer.on("scroll",(e,i)=>{const t=this.getDuration();this.emit("scroll",e*t,i*t)}),this.renderer.on("render",()=>{this.emit("redraw")}));{let e;this.subscriptions.push(this.renderer.on("drag",i=>{this.options.interact&&(this.renderer.renderProgress(i),clearTimeout(e),e=setTimeout(()=>{this.seekTo(i)},this.isPlaying()?0:200),this.emit("interaction",i*this.getDuration()),this.emit("drag",i))}))}}initPlugins(){var e;!((e=this.options.plugins)===null||e===void 0)&&e.length&&this.options.plugins.forEach(i=>{this.registerPlugin(i)})}setOptions(e){this.options=Object.assign({},this.options,e),this.renderer.setOptions(this.options),e.audioRate&&this.setPlaybackRate(e.audioRate),e.mediaControls!=null&&(this.getMediaElement().controls=e.mediaControls)}registerPlugin(e){return e.init(this),this.plugins.push(e),this.subscriptions.push(e.once("destroy",()=>{this.plugins=this.plugins.filter(i=>i!==e)})),e}getWrapper(){return this.renderer.getWrapper()}getScroll(){return this.renderer.getScroll()}getActivePlugins(){return this.plugins}loadAudio(e,i,t,n){return S(this,void 0,void 0,function*(){if(this.emit("load",e),this.isPlaying()&&this.pause(),this.decodedData=null,this.duration=null,!i&&!t){const s=r=>this.emit("loading",r);i=yield Q.fetchBlob(e,s,this.options.fetchParams)}if(this.setSrc(e,i),this.duration=(yield Promise.resolve(n||this.getDuration()))||(yield new Promise(s=>{this.onceMediaEvent("loadedmetadata",()=>s(this.getDuration()))}))||(yield Promise.resolve(0)),t)this.decodedData=$.createBuffer(t,this.duration);else if(i){const s=yield i.arrayBuffer();this.decodedData=yield $.decode(s,this.options.sampleRate),this.duration!==0&&this.duration!==1/0||(this.duration=this.decodedData.duration)}this.emit("decode",this.duration),this.decodedData&&this.renderer.render(this.decodedData),this.emit("ready",this.duration)})}load(e,i,t){return S(this,void 0,void 0,function*(){this.loadAudio(e,void 0,i,t)})}loadBlob(e,i,t){return S(this,void 0,void 0,function*(){this.loadAudio("blob",e,i,t)})}zoom(e){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(e),this.emit("zoom",e)}getDecodedData(){return this.decodedData}exportPeaks({channels:e=1,maxLength:i=8e3,precision:t=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const n=Math.min(e,this.decodedData.numberOfChannels),s=[];for(let r=0;r<n;r++){const a=this.decodedData.getChannelData(r),l=Math.min(a.length,i),d=a.length/l,h=[];for(let c=0;c<l;c++){const p=a[Math.round(c*d)];h.push(Math.round(p*t)/t)}s.push(h)}return s}getDuration(){return this.duration!==null?this.duration:super.getDuration()}toggleInteraction(e){this.options.interact=e}seekTo(e){const i=this.getDuration()*e;this.setTime(i)}playPause(){return S(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(e){this.setTime(this.getCurrentTime()+e)}empty(){this.load("",[[0]],.001)}destroy(){this.emit("destroy"),this.plugins.forEach(e=>e.destroy()),this.subscriptions.forEach(e=>e()),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}function ie(o){return T.create(o)}function I(o){const{plugin:e,options:i,creator:t="create"}=o,n=e[t];if(!e)throw new Error("Please pass a valid plugin in plugin list");if(!t)throw new Error("Please pass the creator function name in 'creator' property.");if(typeof n!="function")throw new Error(`"${t}" is not callable on given plugin. Please pass a valid 'creator' in plugins list.`);return n(i)}const ne=(o,e)=>{const i=[...o],t=[...e],n=i.filter(r=>t.findIndex(a=>a.name===r.name)===-1),s=t.filter(r=>i.findIndex(a=>a.name===r.name)===-1);return{disabled:n,enabled:s}};var re=globalThis&&globalThis.__rest||function(o,e){var i={};for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&e.indexOf(t)<0&&(i[t]=o[t]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,t=Object.getOwnPropertySymbols(o);n<t.length;n++)e.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(o,t[n])&&(i[t[n]]=o[t[n]]);return i};function se(o){var{container:e,plugins:i=[],onMount:t}=o,n=re(o,["container","plugins","onMount"]);const s=w.useRef([]),[r,a]=w.useState(null);return w.useEffect(()=>{if(!e)return;let l=[];i&&(l=i.map(I)),s.current=l;const d=ie(Object.assign(Object.assign({container:e},n),{plugins:l}));return t==null||t(d),a(d),()=>{d.destroy()}},[e]),w.useEffect(()=>{if(r){const l=i.map(I),{disabled:d,enabled:h}=ne(s.current,l);s.current=l,d.forEach(c=>{c.name&&(r==null||r.destroyPlugin(c.name))}),h.forEach(c=>{c.name&&(r==null||r.addPlugin(c).initPlugin(c.name))})}},[i]),r}function oe(o){return!!o&&typeof o!="string"&&typeof o!="number"&&typeof o!="boolean"&&"type"in o&&"props"in o}var ae=globalThis&&globalThis.__rest||function(o,e){var i={};for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&e.indexOf(t)<0&&(i[t]=o[t]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,t=Object.getOwnPropertySymbols(o);n<t.length;n++)e.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(o,t[n])&&(i[t[n]]=o[t[n]]);return i};const U=o=>{var{children:e,plugins:i=[],onMount:t}=o,n=ae(o,["children","plugins","onMount"]);const s=w.useMemo(()=>{let a={};return w.Children.forEach(e,l=>{if(typeof l!="object"||l===null||["string","number"].includes(typeof l)||!oe(l))return;const{props:d,type:h}=l;if(h===F){const{id:c}=d;a=K(d),a=Object.assign(Object.assign({},a),{container:"#"+c})}}),a},[e]),r=se(Object.assign(Object.assign({plugins:i,onMount:t},n),s));return X.createElement(Y.Provider,{value:r},e)};U.defaultProps={children:null,plugins:[]};class G{constructor(){this.listeners={}}on(e,i){return this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(i),()=>this.un(e,i)}once(e,i){const t=this.on(e,i),n=this.on(e,()=>{t(),n()});return t}un(e,i){this.listeners[e]&&(i?this.listeners[e].delete(i):delete this.listeners[e])}unAll(){this.listeners={}}emit(e,...i){this.listeners[e]&&this.listeners[e].forEach(t=>t(...i))}}class le extends G{constructor(e){super(),this.subscriptions=[],this.options=e}onInit(){}init(e){this.wavesurfer=e,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach(e=>e())}}function R(o,e,i,t,n=5){let s=()=>{};if(!o)return s;const r=a=>{if(a.button===2)return;a.preventDefault(),a.stopPropagation();let l=a.clientX,d=a.clientY,h=!1;const c=u=>{u.preventDefault(),u.stopPropagation();const m=u.clientX,v=u.clientY;if(h||Math.abs(m-l)>=n||Math.abs(v-d)>=n){const{left:y,top:C}=o.getBoundingClientRect();h||(h=!0,i==null||i(l-y,d-C)),e(m-l,v-d,m-y,v-C),l=m,d=v}},p=u=>{h&&(u.preventDefault(),u.stopPropagation())},f=()=>{h&&(t==null||t()),s()};document.addEventListener("pointermove",c),document.addEventListener("pointerup",f),document.addEventListener("pointerleave",f),document.addEventListener("click",p,!0),s=()=>{document.removeEventListener("pointermove",c),document.removeEventListener("pointerup",f),document.removeEventListener("pointerleave",f),setTimeout(()=>{document.removeEventListener("click",p,!0)},10)}};return o.addEventListener("pointerdown",r),()=>{s(),o.removeEventListener("pointerdown",r)}}class B extends G{constructor(e,i){var t,n,s,r,a,l;super(),this.totalDuration=i,this.minLength=0,this.maxLength=1/0,this.id=e.id||`region-${Math.random().toString(32).slice(2)}`,this.start=e.start,this.end=(t=e.end)!==null&&t!==void 0?t:e.start,this.drag=(n=e.drag)!==null&&n!==void 0?n:!0,this.resize=(s=e.resize)!==null&&s!==void 0?s:!0,this.color=(r=e.color)!==null&&r!==void 0?r:"rgba(0, 0, 0, 0.1)",this.minLength=(a=e.minLength)!==null&&a!==void 0?a:this.minLength,this.maxLength=(l=e.maxLength)!==null&&l!==void 0?l:this.maxLength,this.element=this.initElement(e.content),this.renderPosition(),this.initMouseEvents()}initElement(e){const i=document.createElement("div"),t=this.start===this.end;if(i.setAttribute("part",`${t?"marker":"region"} ${this.id}`),i.setAttribute("style",`
      position: absolute;
      height: 100%;
      background-color: ${t?"none":this.color};
      border-left: ${t?"2px solid "+this.color:"none"};
      border-radius: 2px;
      box-sizing: border-box;
      transition: background-color 0.2s ease;
      cursor: ${this.drag?"grab":"default"};
      pointer-events: all;
    `),e&&(typeof e=="string"?(this.content=document.createElement("div"),this.content.style.padding=`0.2em ${t?.2:.4}em`,this.content.textContent=e):this.content=e,this.content.setAttribute("part","region-content"),i.appendChild(this.content)),!t){const n=document.createElement("div");n.setAttribute("data-resize","left"),n.setAttribute("style",`
        position: absolute;
        z-index: 2;
        width: 6px;
        height: 100%;
        top: 0;
        left: 0;
        border-left: 2px solid rgba(0, 0, 0, 0.5);
        border-radius: 2px 0 0 2px;
        cursor: ${this.resize?"ew-resize":"default"};
        word-break: keep-all;
      `),n.setAttribute("part","region-handle region-handle-left");const s=n.cloneNode();s.setAttribute("data-resize","right"),s.style.left="",s.style.right="0",s.style.borderRight=s.style.borderLeft,s.style.borderLeft="",s.style.borderRadius="0 2px 2px 0",s.setAttribute("part","region-handle region-handle-right"),i.appendChild(n),i.appendChild(s)}return i}renderPosition(){const e=this.start/this.totalDuration,i=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left=`${e*100}%`,this.element.style.right=`${i*100}%`}initMouseEvents(){const{element:e}=this;if(!e)return;e.addEventListener("click",t=>this.emit("click",t)),e.addEventListener("mouseenter",t=>this.emit("over",t)),e.addEventListener("mouseleave",t=>this.emit("leave",t)),e.addEventListener("dblclick",t=>this.emit("dblclick",t)),R(e,t=>this.onMove(t),()=>this.onStartMoving(),()=>this.onEndMoving());const i=1;R(e.querySelector('[data-resize="left"]'),t=>this.onResize(t,"start"),()=>null,()=>this.onEndResizing(),i),R(e.querySelector('[data-resize="right"]'),t=>this.onResize(t,"end"),()=>null,()=>this.onEndResizing(),i)}onStartMoving(){this.drag&&(this.element.style.cursor="grabbing")}onEndMoving(){this.drag&&(this.element.style.cursor="grab",this.emit("update-end"))}_onUpdate(e,i){if(!this.element.parentElement)return;const t=e/this.element.parentElement.clientWidth*this.totalDuration,n=!i||i==="start"?this.start+t:this.start,s=!i||i==="end"?this.end+t:this.end,r=s-n;n>=0&&s<=this.totalDuration&&n<=s&&r>=this.minLength&&r<=this.maxLength&&(this.start=n,this.end=s,this.renderPosition(),this.emit("update"))}onMove(e){this.drag&&this._onUpdate(e)}onResize(e,i){this.resize&&this._onUpdate(e,i)}onEndResizing(){this.resize&&this.emit("update-end")}_setTotalDuration(e){this.totalDuration=e,this.renderPosition()}play(){this.emit("play")}setOptions(e){var i,t;e.color&&(this.color=e.color,this.element.style.backgroundColor=this.color),e.drag!==void 0&&(this.drag=e.drag,this.element.style.cursor=this.drag?"grab":"default"),e.resize!==void 0&&(this.resize=e.resize,this.element.querySelectorAll("[data-resize]").forEach(n=>{n.style.cursor=this.resize?"ew-resize":"default"})),(e.start!==void 0||e.end!==void 0)&&(this.start=(i=e.start)!==null&&i!==void 0?i:this.start,this.end=(t=e.end)!==null&&t!==void 0?t:this.end,this.renderPosition())}remove(){this.emit("remove"),this.element.remove(),this.element=null}}class A extends le{constructor(e){super(e),this.regions=[],this.regionsContainer=this.initRegionsContainer()}static create(e){return new A(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let e=null;this.subscriptions.push(this.wavesurfer.on("timeupdate",i=>{const t=this.regions.find(n=>n.start<=i&&n.end>=i);e&&e!==t&&(this.emit("region-out",e),e=null),t&&t!==e&&(e=t,this.emit("region-in",t))}))}initRegionsContainer(){const e=document.createElement("div");return e.setAttribute("style",`
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 3;
      pointer-events: none;
    `),e}getRegions(){return this.regions}avoidOverlapping(e){if(!e.content)return;const i=e.content,t=i.getBoundingClientRect().left,n=e.element.scrollWidth,s=this.regions.filter(r=>{if(r===e||!r.content)return!1;const a=r.content.getBoundingClientRect().left,l=r.element.scrollWidth;return t<a+l&&a<t+n}).map(r=>{var a;return((a=r.content)===null||a===void 0?void 0:a.getBoundingClientRect().height)||0}).reduce((r,a)=>r+a,0);i.style.marginTop=`${s}px`}saveRegion(e){this.regionsContainer.appendChild(e.element),this.avoidOverlapping(e),this.regions.push(e),this.emit("region-created",e);const i=[e.on("update-end",()=>{this.avoidOverlapping(e),this.emit("region-updated",e)}),e.on("play",()=>{var t,n;(t=this.wavesurfer)===null||t===void 0||t.play(),(n=this.wavesurfer)===null||n===void 0||n.setTime(e.start)}),e.on("click",t=>{this.emit("region-clicked",e,t)}),e.on("dblclick",t=>{this.emit("region-double-clicked",e,t)}),e.once("remove",()=>{i.forEach(t=>t()),this.regions=this.regions.filter(t=>t!==e)})];this.subscriptions.push(...i)}addRegion(e){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");const i=this.wavesurfer.getDuration(),t=new B(e,i);return i?this.saveRegion(t):this.subscriptions.push(this.wavesurfer.once("ready",n=>{t._setTotalDuration(n),this.saveRegion(t)})),t}enableDragSelection(e){var i,t;const n=(t=(i=this.wavesurfer)===null||i===void 0?void 0:i.getWrapper())===null||t===void 0?void 0:t.querySelector("div");if(!n)return()=>{};const s=5;let r=null,a=0;return R(n,(l,d,h)=>{r&&r._onUpdate(l,h>a?"end":"start")},l=>{if(a=l,!this.wavesurfer)return;const d=this.wavesurfer.getDuration(),h=this.wavesurfer.getWrapper().clientWidth,c=l/h*d,p=(l+s)/h*d;r=new B(Object.assign(Object.assign({},e),{start:c,end:p}),d),this.regionsContainer.appendChild(r.element)},()=>{r&&(this.saveRegion(r),r=null)})}clearRegions(){this.regions.forEach(e=>e.remove())}destroy(){this.clearRegions(),super.destroy()}}const he=[{plugin:A,options:{dragSelection:!0}}];function k(o){const e=w.useRef(null),i=w.useCallback(n=>{e.current=n,e.current&&(e.current.load(o.source),e.current.on("ready",()=>{console.log("WaveSurfer is ready")}))},[]),t=w.useCallback(()=>{e.current&&e.current.playPause()},[]);return x.jsxDEV("div",{style:{border:"thin solid red"},children:[x.jsxDEV("h1",{children:"Audio Player: WaveSurfer"},void 0,!1,{fileName:"/app/src/components/AudioPlayer.tsx",lineNumber:42,columnNumber:13},this),x.jsxDEV(U,{plugins:he,onMount:i,children:[x.jsxDEV(F,{id:"waveform",cursorColor:"transparent"},void 0,!1,{fileName:"/app/src/components/AudioPlayer.tsx",lineNumber:44,columnNumber:17},this),x.jsxDEV("div",{id:"timeline"},void 0,!1,{fileName:"/app/src/components/AudioPlayer.tsx",lineNumber:45,columnNumber:17},this)]},void 0,!0,{fileName:"/app/src/components/AudioPlayer.tsx",lineNumber:43,columnNumber:13},this),x.jsxDEV("button",{onClick:t,children:"Play / Pause"},void 0,!1,{fileName:"/app/src/components/AudioPlayer.tsx",lineNumber:47,columnNumber:13},this),x.jsxDEV("pre",{children:JSON.stringify({props:o},null,2)},void 0,!1,{fileName:"/app/src/components/AudioPlayer.tsx",lineNumber:48,columnNumber:13},this)]},void 0,!0,{fileName:"/app/src/components/AudioPlayer.tsx",lineNumber:41,columnNumber:9},this)}try{k.displayName="AudioPlayer",k.__docgenInfo={description:"",displayName:"AudioPlayer",props:{source:{defaultValue:null,description:"",name:"source",required:!0,type:{name:"unknown"}}}}}catch{}const pe={title:"Components/AudioPlayer",component:k,argTypes:{source:"string"}},O={args:{source:"/recording.wav"}};var H,V,q;O.parameters={...O.parameters,docs:{...(H=O.parameters)==null?void 0:H.docs,source:{originalSource:`{
  args: {
    source: "/recording.wav"
  }
}`,...(q=(V=O.parameters)==null?void 0:V.docs)==null?void 0:q.source}}};const me=["Primary"];export{O as Primary,me as __namedExportsOrder,pe as default};
//# sourceMappingURL=AudioPlayer.stories-683e9b3a.js.map
